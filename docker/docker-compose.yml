version: '3'
services:
    central:
        build: .
        container_name: central
        hostname: central
        volumes:
            - "../slaves/:/root/slaves"
        command: >
            bash -c "/usr/sbin/sshd -D
                && python /root/slaves/rpyc_classic.py --host 0.0.0.0"

    zebra:
        build: .
        container_name: zebra
        hostname: zebra
        volumes:
            - "../slaves/:/root/slaves"
        command: >
            bash -c "/usr/sbin/sshd -D
                && python /root/slaves/rpyc_classic.py --host 0.0.0.0"

    giraffe:
        build: .
        container_name: giraffe
        hostname: giraffe
        volumes:
            - "../slaves/:/root/slaves"
        command: >
            bash -c "/usr/sbin/sshd -D
                && python /root/slaves/rpyc_classic.py --host 0.0.0.0"

    elephant:
        build: .
        container_name: elephant
        hostname: elephant
        volumes:
            - "../slaves/:/root/slaves"
        command: >
            bash -c "/usr/sbin/sshd -D
                && python /root/slaves/rpyc_classic.py --host 0.0.0.0"

    dns:
        image: defreitas/dns-proxy-server
        container_name: dns-proxy-server
        hostname: dns.mageddo
        restart: unless-stopped
        ports: 
            - "5380:5380"
        volumes:
            - "/opt/dns-proxy-server/conf:/app/conf"
            - "/var/run/docker.sock:/var/run/docker.sock"
            - "/run:/host/run"
        environment:
            - MG_RESOLVCONF=/host/run/resolvconf/resolv.conf


